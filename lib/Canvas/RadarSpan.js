"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),RadarSpan=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.id=Math.random()+"-canvas",i.scaleRatio=2,i.offCanvas=document.createElement("canvas"),i.offContext=i.offCanvas.getContext("2d"),i.minLength=0,i.theme=t.theme||"blue",i.Grid=function(t,e,i,n){this.context=n,this.color=t,this.width=e,this.height=i},i.Grid.prototype.drawGrid=function(){this.context.save(),this.context.strokeStyle=this.color||"transparent",this.context.lineWidth=2,this.drawY(),this.drawX(),this.context.restore()},i.Grid.prototype.drawX=function(){for(var t=this.height,e=t/16,i=this.width,n=0;n<=t;n+=e)this.context.beginPath(),this.context.moveTo(0,n),this.context.lineTo(i,n),this.context.stroke();this.context.beginPath(),this.context.moveTo(0,t-1),this.context.lineTo(i,t-1),this.context.stroke()},i.Grid.prototype.drawY=function(){for(var t=this.width,e=t/16,i=this.height,n=0;n<=t;n+=e)this.context.beginPath(),this.context.moveTo(n,0),this.context.lineTo(n,i),this.context.stroke();this.context.beginPath(),this.context.moveTo(t-1,0),this.context.lineTo(t-1,i),this.context.stroke()},i.RadarScan=function(t,e,i,n,a,s){this.x=t,this.y=e,this.radius=i,this.color=n,this.context=a,this.canvasWidth=this.context.canvas.width,this.canvasHeight=this.context.canvas.height,this.angle=0,this.offscreenCanvas=s},i.RadarScan.prototype.drawPan=function(){var t=this.radius/5;this.context.save(),this.context.strokeStyle=this.color+"0.8)",this.context.lineWidth=4;for(var e=t;e<=this.radius;e+=t)this.context.beginPath(),this.context.arc(this.x,this.y,e,0,2*Math.PI),this.context.stroke();this.context.restore()},i.RadarScan.prototype.radarLine=function(){for(var t=1/(1.5*Math.PI/4/.006),e=this.angle,i=0;e<=1.5*Math.PI/4+this.angle;e+=.006,i+=1)this.context.lineWidth=4,this.context.beginPath(),this.context.strokeStyle=""+this.color+(1-t*i)+")",this.context.moveTo(this.x,this.y),this.context.lineTo(this.x+this.radius*Math.cos(e),this.y+this.radius*Math.sin(e)),this.context.stroke()},i.RadarScan.prototype.animate=function(){this.context.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.context.drawImage(this.offscreenCanvas,0,0),this.angle-=.03,this.radarLine(),window.requestAnimationFrame(this.animate.bind(this))},i.RadarScan.prototype.startA=function(){window.requestAnimationFrame(this.animate.bind(this))},i}return _inherits(e,_react2.default.Component),_createClass(e,[{key:"componentDidMount",value:function(){this.canvas=document.getElementById(this.id),this.context=this.canvas.getContext("2d");var t=window.getComputedStyle(this.canvas.parentNode),e=Math.floor(window.parseInt(t.width)),i=Math.floor(window.parseInt(t.height));this.canvas.style.width=e+"px",this.canvas.style.height=i+"px",this.canvas.width=e*this.scaleRatio,this.canvas.height=i*this.scaleRatio,this.offCanvas.width=e*this.scaleRatio,this.offCanvas.height=i*this.scaleRatio,this.minLength=Math.min(this.canvas.width,this.canvas.height),this.context.translate(.5,.5),this.grids=new this.Grid("blue"===this.theme?"rgba(34,104,160,0.3)":"rgba(48,62,51,0.3)",this.canvas.width,this.canvas.height,this.context),this.grids.drawGrid(),this.radar=new this.RadarScan(this.canvas.width/2,this.canvas.height/2,.9*this.minLength/2,"blue"===this.theme?"rgba(80,159,198,":"rgba(108,192,118,",this.context,this.offCanvas),this.radar.drawPan(),this.offContext.drawImage(this.canvas,0,0),this.radar.startA()}},{key:"render",value:function(){return _react2.default.createElement("div",{style:{position:"relative",width:"100%",height:"100%"}},_react2.default.createElement("canvas",{id:this.id},"对不起，您的浏览器不支持canvas"))}}]),e}();exports.default=RadarSpan;